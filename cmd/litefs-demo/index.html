<html class="h-full">
<head>
  <title>Litestream Cloud Demo</title>
</head>

<body>

<h1>Litestream Cloud Demo</h1>

<table id="tbl" border="1" cellpadding="5">
  <thead>
    <tr>
      <th>Region</th>
      <th>Value</th>
      <th>&nbsp;</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>Chicago</td>
      <td class="value ord">-</td>
      <td>
        <button onclick="inc('ord')">+</button>
      </td>
    </tr>
    <tr>
      <td>Dallas</td>
      <td class="value dfw">-</td>
      <td>
        <button onclick="inc('dfw')">+</button>
      </td>
    </tr>
    <tr>
      <td>Amsterdam</td>
      <td class="value ams">-</td>
      <td>
        <button onclick="inc('ams')">+</button>
      </td>
    </tr>
    <tr>
      <td>Tokyo</td>
      <td class="value nrt">-</td>
      <td>
        <button onclick="inc('nrt')">+</button>
      </td>
    </tr>
  </tbody>
</table>

<script>
var regions = ['ord', 'nrt', 'ams', 'dfw'];

async function init() {
  regions.forEach(region => monitor(region))
}

function monitor(region) {
  var sse = new EventSource('/api/stream?region=' + region);
  sse.addEventListener("update", function(e) {
    const data = JSON.parse(e.data)
    document.querySelector('.value.' + region).innerText = data.value + ' (' + data.region + ')'
  })
}

function inc(region) {
  fetch('/api/inc?region=' + region, {method: 'POST'})
    .then(response => response.json())
    .then(data => {
      if (data.error !== undefined) throw data.error
    })
    .catch((error) => alert(error))
}

init()
</script>

</body>
</html>
